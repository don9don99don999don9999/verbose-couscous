{"version":3,"file":"clientsession.js","sourceRoot":"","sources":["../../../../apputils/src/clientsession.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n\nimport {\n  PathExt, uuid\n} from '@jupyterlab/coreutils';\n\nimport {\n  Kernel, KernelMessage, ServerConnection, Session\n} from '@jupyterlab/services';\n\nimport {\n  IterableOrArrayLike, each, find\n} from '@phosphor/algorithm';\n\nimport {\n  PromiseDelegate\n} from '@phosphor/coreutils';\n\nimport {\n  IDisposable\n} from '@phosphor/disposable';\n\nimport {\n  ISignal, Signal\n} from '@phosphor/signaling';\n\nimport {\n  h\n} from '@phosphor/virtualdom';\n\nimport {\n  Widget\n} from '@phosphor/widgets';\n\nimport {\n  showDialog, Dialog\n} from './dialog';\n\n\n/**\n * The interface of client session object.\n *\n * The client session represents the link between\n * a path and its kernel for the duration of the lifetime\n * of the session object.  The session can have no current\n * kernel, and can start a new kernel at any time.\n */\nexport\ninterface IClientSession extends IDisposable {\n  /**\n   * A signal emitted when the session is shut down.\n   */\n  readonly terminated: ISignal<this, void>;\n\n  /**\n   * A signal emitted when the kernel changes.\n   */\n  readonly kernelChanged: ISignal<this, Kernel.IKernelConnection | null>;\n\n  /**\n   * A signal emitted when the kernel status changes.\n   */\n  readonly statusChanged: ISignal<this, Kernel.Status>;\n\n  /**\n   * A signal emitted for a kernel messages.\n   */\n  readonly iopubMessage: ISignal<this, KernelMessage.IMessage>;\n\n  /**\n   * A signal emitted for an unhandled kernel message.\n   */\n  readonly unhandledMessage: ISignal<this, KernelMessage.IMessage>;\n\n  /**\n   * A signal emitted when a session property changes.\n   */\n  readonly propertyChanged: ISignal<this, 'path' | 'name' | 'type'>;\n\n  /**\n   * The current kernel associated with the document.\n   */\n  readonly kernel: Kernel.IKernelConnection | null;\n\n  /**\n   * The current path associated with the client sesssion.\n   */\n  readonly path: string;\n\n  /**\n   * The current name associated with the client sesssion.\n   */\n  readonly name: string;\n\n  /**\n   * The type of the client session.\n   */\n  readonly type: string;\n\n  /**\n   * The current status of the client session.\n   */\n  readonly status: Kernel.Status;\n\n  /**\n   * Whether the session is ready.\n   */\n  readonly isReady: boolean;\n\n /**\n  * A promise that is fulfilled when the session is ready.\n  */\n  readonly ready: Promise<void>;\n\n  /**\n   * The kernel preference.\n   */\n  kernelPreference: IClientSession.IKernelPreference;\n\n  /**\n   * The display name of the kernel.\n   */\n  readonly kernelDisplayName: string;\n\n  /**\n   * Change the current kernel associated with the document.\n   */\n  changeKernel(options: Partial<Kernel.IModel>): Promise<Kernel.IKernelConnection>;\n\n  /**\n   * Kill the kernel and shutdown the session.\n   *\n   * @returns A promise that resolves when the session is shut down.\n   */\n  shutdown(): Promise<void>;\n\n  /**\n   * Select a kernel for the session.\n   */\n  selectKernel(): Promise<void>;\n\n  /**\n   * Restart the session.\n   *\n   * @returns A promise that resolves with the kernel model.\n   *\n   * #### Notes\n   * If there is a running kernel, present a dialog.\n   * If there is no kernel, we start a kernel with the last run\n   * kernel name.  If no kernel has been started, this is a no-op.\n   */\n  restart(): Promise<Kernel.IKernelConnection | null>;\n\n  /**\n   * Change the session path.\n   *\n   * @param path - The new session path.\n   *\n   * @returns A promise that resolves when the session has renamed.\n   *\n   * #### Notes\n   * This uses the Jupyter REST API, and the response is validated.\n   * The promise is fulfilled on a valid response and rejected otherwise.\n   */\n  setPath(path: string): Promise<void>;\n\n  /**\n   * Change the session name.\n   */\n  setName(name: string): Promise<void>;\n\n  /**\n   * Change the session type.\n   */\n  setType(type: string): Promise<void>;\n}\n\n\n/**\n * The namespace for Client Session related interfaces.\n */\nexport\nnamespace IClientSession {\n  /**\n   * A kernel preference.\n   */\n  export\n  interface IKernelPreference {\n    /**\n     * The name of the kernel.\n     */\n    readonly name?: string;\n\n    /**\n     * The preferred kernel language.\n     */\n    readonly language?: string;\n\n    /**\n     * The id of an existing kernel.\n     */\n    readonly id?: string;\n\n    /**\n     * Whether to prefer starting a kernel.\n     */\n    readonly shouldStart?: boolean;\n\n    /**\n     * Whether a kernel can be started.\n     */\n    readonly canStart?: boolean;\n\n    /**\n     * Whether to auto-start the default kernel if no matching kernel is found.\n     */\n    readonly autoStartDefault?: boolean;\n  }\n}\n\n\n/**\n * The default implementation of client session object.\n */\nexport\nclass ClientSession implements IClientSession {\n  /**\n   * Construct a new client session.\n   */\n  constructor(options: ClientSession.IOptions) {\n    this.manager = options.manager;\n    this._path = options.path || uuid();\n    this._type = options.type || '';\n    this._name = options.name || '';\n    this._kernelPreference = options.kernelPreference || {};\n  }\n\n  /**\n   * A signal emitted when the session is shut down.\n   */\n  get terminated(): ISignal<this, void> {\n    return this._terminated;\n  }\n\n  /**\n   * A signal emitted when the kernel changes.\n   */\n  get kernelChanged(): ISignal<this, Kernel.IKernelConnection | null> {\n    return this._kernelChanged;\n  }\n\n  /**\n   * A signal emitted when the status changes.\n   */\n  get statusChanged(): ISignal<this, Kernel.Status> {\n    return this._statusChanged;\n  }\n\n  /**\n   * A signal emitted for iopub kernel messages.\n   */\n  get iopubMessage(): ISignal<this, KernelMessage.IMessage> {\n    return this._iopubMessage;\n  }\n\n  /**\n   * A signal emitted for an unhandled kernel message.\n   */\n  get unhandledMessage(): ISignal<this, KernelMessage.IMessage> {\n    return this._unhandledMessage;\n  }\n\n  /**\n   * A signal emitted when a session property changes.\n   */\n  get propertyChanged(): ISignal<this, 'path' | 'name' | 'type'> {\n    return this._propertyChanged;\n  }\n\n  /**\n   * The current kernel of the session.\n   */\n  get kernel(): Kernel.IKernelConnection | null {\n    return this._session ? this._session.kernel : null;\n  }\n\n  /**\n   * The current path of the session.\n   */\n  get path(): string {\n    return this._path;\n  }\n\n  /**\n   * The current name of the session.\n   */\n  get name(): string {\n    return this._name;\n  }\n\n  /**\n   * The type of the client session.\n   */\n  get type(): string {\n    return this._type;\n  }\n\n  /**\n   * The kernel preference of the session.\n   */\n  get kernelPreference(): IClientSession.IKernelPreference {\n    return this._kernelPreference;\n  }\n  set kernelPreference(value: IClientSession.IKernelPreference) {\n    this._kernelPreference = value;\n  }\n\n  /**\n   * The session manager used by the session.\n   */\n  readonly manager: Session.IManager;\n\n  /**\n   * The current status of the session.\n   */\n  get status(): Kernel.Status {\n    if (!this.isReady) {\n      return 'starting';\n    }\n    return this._session ? this._session.status : 'dead';\n  }\n\n  /**\n   * Whether the session is ready.\n   */\n  get isReady(): boolean {\n    return this._isReady;\n  }\n\n /**\n  * A promise that is fulfilled when the session is ready.\n  */\n  get ready(): Promise<void> {\n    return this._ready.promise;\n  }\n\n  /**\n   * The display name of the current kernel.\n   */\n  get kernelDisplayName(): string {\n    let kernel = this.kernel;\n    if (!kernel) {\n      return 'No Kernel!';\n    }\n    let specs = this.manager.specs;\n    if (!specs  ) {\n      return 'Unknown!';\n    }\n    let spec = specs.kernelspecs[kernel.name];\n    return spec ? spec.display_name : kernel.name;\n  }\n\n  /**\n   * Test whether the context is disposed.\n   */\n  get isDisposed(): boolean {\n    return this._isDisposed;\n  }\n\n  /**\n   * Dispose of the resources held by the context.\n   */\n  dispose(): void {\n    if (this._isDisposed) {\n      return;\n    }\n    this._isDisposed = true;\n    if (this._session) {\n      this._session = null;\n    }\n    if (this._dialog) {\n      this._dialog.dispose();\n    }\n    Signal.clearData(this);\n  }\n\n  /**\n   * Change the current kernel associated with the document.\n   */\n  changeKernel(options: Partial<Kernel.IModel>): Promise<Kernel.IKernelConnection> {\n    return this.initialize().then(() => {\n      if (this.isDisposed) {\n        return Promise.reject('Disposed');\n      }\n      return this._changeKernel(options);\n    });\n  }\n\n  /**\n   * Select a kernel for the session.\n   */\n  selectKernel(): Promise<void> {\n    return this.initialize().then(() => {\n      if (this.isDisposed) {\n        return Promise.reject('Disposed');\n      }\n      return this._selectKernel();\n    });\n  }\n\n  /**\n   * Kill the kernel and shutdown the session.\n   *\n   * @returns A promise that resolves when the session is shut down.\n   */\n  shutdown(): Promise<void> {\n    const session = this._session;\n    if (this.isDisposed || !session) {\n      return Promise.resolve(void 0);\n    }\n    this._session = null;\n    return session.shutdown();\n  }\n\n  /**\n   * Restart the session.\n   *\n   * @returns A promise that resolves with the kernel model.\n   *\n   * #### Notes\n   * If there is a running kernel, present a dialog.\n   * If there is no kernel, we start a kernel with the last run\n   * kernel name.\n   * If no kernel has been started, this is a no-op.\n   */\n  restart(): Promise<Kernel.IKernelConnection | null> {\n    return this.initialize().then(() => {\n      if (this.isDisposed) {\n        return Promise.reject(void 0);\n      }\n      let kernel = this.kernel;\n      if (!kernel) {\n        if (this._prevKernelName) {\n          return this.changeKernel({ name: this._prevKernelName });\n        }\n        // Bail if there is no previous kernel to start.\n        return Promise.reject('No kernel to restart');\n      }\n      return ClientSession.restartKernel(kernel);\n    });\n  }\n\n  /**\n   * Change the session path.\n   *\n   * @param path - The new session path.\n   *\n   * @returns A promise that resolves when the session has renamed.\n   *\n   * #### Notes\n   * This uses the Jupyter REST API, and the response is validated.\n   * The promise is fulfilled on a valid response and rejected otherwise.\n   */\n  setPath(path: string): Promise<void> {\n    if (this.isDisposed || this._path === path) {\n      return Promise.resolve(void 0);\n    }\n    this._path = path;\n    if (this._session) {\n      return this._session.setPath(path);\n    }\n    this._propertyChanged.emit('path');\n    return Promise.resolve(void 0);\n  }\n\n  /**\n   * Change the session name.\n   */\n  setName(name: string): Promise<void> {\n    if (this.isDisposed || this._name === name) {\n      return Promise.resolve(void 0);\n    }\n    this._name = name;\n    if (this._session) {\n      return this._session.setName(name);\n    }\n    this._propertyChanged.emit('name');\n    return Promise.resolve(void 0);\n  }\n\n  /**\n   * Change the session type.\n   */\n  setType(type: string): Promise<void> {\n    if (this.isDisposed || this._type === type) {\n      return Promise.resolve(void 0);\n    }\n    this._type = type;\n    if (this._session) {\n      return this._session.setType(name);\n    }\n    this._propertyChanged.emit('type');\n    return Promise.resolve(void 0);\n  }\n\n  /**\n   * Initialize the session.\n   *\n   * #### Notes\n   * If a server session exists on the current path, we will connect to it.\n   * If preferences include disabling `canStart` or `shouldStart`, no\n   * server session will be started.\n   * If a kernel id is given, we attempt to start a session with that id.\n   * If a default kernel is available, we connect to it.\n   * Otherwise we ask the user to select a kernel.\n   */\n  initialize(): Promise<void> {\n    if (this._initializing || this._isReady) {\n      return this._ready.promise;\n    }\n    this._initializing = true;\n    let manager = this.manager;\n    return manager.ready.then(() => {\n      let model = find(manager.running(), item => {\n        return item.path === this._path;\n      });\n      if (!model) {\n        return;\n      }\n      return manager.connectTo(model).then(session => {\n        this._handleNewSession(session);\n      }).catch(err => {\n        this._handleSessionError(err);\n      });\n    }).then(() => {\n      return this._startIfNecessary();\n    }).then(() => {\n      this._isReady = true;\n      this._ready.resolve(void 0);\n    });\n  }\n\n  /**\n   * Start the session if necessary.\n   */\n  private _startIfNecessary(): Promise<void> {\n    let preference = this.kernelPreference;\n    if (this.isDisposed ||\n        this.kernel || preference.shouldStart === false ||\n        preference.canStart === false) {\n      return Promise.resolve(void 0);\n    }\n    // Try to use an existing kernel.\n    if (preference.id) {\n      return this._changeKernel({ id: preference.id }).then(\n        () => void 0,\n        () => this._selectKernel()\n      );\n    }\n    let name = ClientSession.getDefaultKernel({\n      specs: this.manager.specs,\n      sessions: this.manager.running(),\n      preference\n    });\n    if (name) {\n      return this._changeKernel({ name }).then(\n        () => void 0,\n        () => this._selectKernel()\n      );\n    }\n    return this._selectKernel();\n  }\n\n  /**\n   * Change the kernel.\n   */\n  private _changeKernel(options: Partial<Kernel.IModel>): Promise<Kernel.IKernelConnection> {\n    if (this.isDisposed) {\n      return Promise.reject('Disposed');\n    }\n    let session = this._session;\n    if (session) {\n      return session.changeKernel(options);\n    } else {\n      return this._startSession(options);\n    }\n  }\n\n  /**\n   * Select a kernel.\n   */\n  private _selectKernel(): Promise<void> {\n    if (this.isDisposed) {\n      return Promise.resolve(void 0);\n    }\n    let dialog = this._dialog = new Dialog({\n      title: 'Select Kernel',\n      body: new Private.KernelSelector(this),\n      buttons: [Dialog.cancelButton(), Dialog.okButton({ label: 'SELECT' })]\n    });\n\n    return dialog.launch().then(result => {\n      if (this.isDisposed || !result.button.accept) {\n        return;\n      }\n      let model = result.value;\n      if (model === null && this._session) {\n        return this.shutdown().then(() => this._kernelChanged.emit(null));\n      }\n      if (model) {\n        return this._changeKernel(model).then(() => void 0);\n      }\n    }).then(() => { this._dialog = null; });\n  }\n\n  /**\n   * Start a session and set up its signals.\n   */\n  private _startSession(model: Partial<Kernel.IModel>): Promise<Kernel.IKernelConnection> {\n    if (this.isDisposed) {\n      return Promise.reject('Session is disposed.');\n    }\n    return this.manager.startNew({\n      path: this._path,\n      type: this._type,\n      name: this._name,\n      kernelName: model ? model.name : undefined,\n      kernelId: model ? model.id : undefined\n    }).then(session => {\n      return this._handleNewSession(session);\n    }).catch(err => {\n      this._handleSessionError(err);\n      return Promise.reject(err);\n    });\n  }\n\n  /**\n   * Handle a new session object.\n   */\n  private _handleNewSession(session: Session.ISession): Kernel.IKernelConnection {\n    if (this.isDisposed) {\n      throw Error('Disposed');\n    }\n    if (this._session) {\n      this._session.dispose();\n    }\n    this._session = session;\n    if (session.path !== this._path) {\n      this._path = session.path;\n      this._propertyChanged.emit('path');\n    }\n    if (session.name !== this._name) {\n      this._name = session.name;\n      this._propertyChanged.emit('name');\n    }\n    if (session.type !== this._type) {\n      this._type = session.type;\n      this._propertyChanged.emit('type');\n    }\n\n    session.terminated.connect(this._onTerminated, this);\n    session.propertyChanged.connect(this._onPropertyChanged, this);\n    session.kernelChanged.connect(this._onKernelChanged, this);\n    session.statusChanged.connect(this._onStatusChanged, this);\n    session.iopubMessage.connect(this._onIopubMessage, this);\n    session.unhandledMessage.connect(this._onUnhandledMessage, this);\n    this._kernelChanged.emit(session.kernel);\n    this._prevKernelName = session.kernel.name;\n    return session.kernel;\n  }\n\n  /**\n   * Handle an error in session startup.\n   */\n  private _handleSessionError(err: ServerConnection.ResponseError): Promise<void> {\n    return err.response.text().then(text => {\n      let message = err.message;\n      try {\n        message = JSON.parse(text)['traceback'];\n      } catch (err) {\n        // no-op\n      }\n      let dialog = this._dialog = new Dialog({\n        title: 'Error Starting Kernel',\n        body: h.pre(message),\n        buttons: [Dialog.okButton()]\n      });\n      return dialog.launch();\n    }).then(() => { this._dialog = null; });\n  }\n\n  /**\n   * Handle a session termination.\n   */\n  private _onTerminated(): void {\n    let kernel = this.kernel;\n    if (this._session) {\n      this._session.dispose();\n    }\n    this._session = null;\n    this._terminated.emit(void 0);\n    if (kernel) {\n      this._kernelChanged.emit(null);\n    }\n  }\n\n  /**\n   * Handle a change to a session property.\n   */\n  private _onPropertyChanged(sender: Session.ISession, property: 'path' | 'name' | 'type') {\n    switch (property) {\n    case 'path':\n      this._path = sender.path;\n      break;\n    case 'name':\n      this._name = sender.name;\n      break;\n    default:\n      this._type = sender.type;\n      break;\n    }\n    this._propertyChanged.emit(property);\n  }\n\n  /**\n   * Handle a change to the kernel.\n   */\n  private _onKernelChanged(sender: Session.ISession): void {\n    this._kernelChanged.emit(sender.kernel);\n  }\n\n  /**\n   * Handle a change to the session status.\n   */\n  private _onStatusChanged(): void {\n    this._statusChanged.emit(this.status);\n  }\n\n  /**\n   * Handle an iopub message.\n   */\n  private _onIopubMessage(sender: Session.ISession, message: KernelMessage.IIOPubMessage): void {\n    this._iopubMessage.emit(message);\n  }\n\n  /**\n   * Handle an unhandled message.\n   */\n  private _onUnhandledMessage(sender: Session.ISession, message: KernelMessage.IMessage): void {\n    this._unhandledMessage.emit(message);\n  }\n\n  private _path = '';\n  private _name = '';\n  private _type = '';\n  private _prevKernelName = '';\n  private _kernelPreference: IClientSession.IKernelPreference;\n  private _isDisposed = false;\n  private _session: Session.ISession | null = null;\n  private _ready = new PromiseDelegate<void>();\n  private _initializing = false;\n  private _isReady = false;\n  private _terminated = new Signal<this, void>(this);\n  private _kernelChanged = new Signal<this, Kernel.IKernelConnection | null>(this);\n  private _statusChanged = new Signal<this, Kernel.Status>(this);\n  private _iopubMessage = new Signal<this, KernelMessage.IMessage>(this);\n  private _unhandledMessage = new Signal<this, KernelMessage.IMessage>(this);\n  private _propertyChanged = new Signal<this, 'path' | 'name' | 'type'>(this);\n  private _dialog: Dialog<any> | null = null;\n}\n\n\n/**\n * A namespace for `ClientSession` statics.\n */\nexport\nnamespace ClientSession {\n  /**\n   * The options used to initialize a context.\n   */\n  export\n  interface IOptions {\n    /**\n     * A session manager instance.\n     */\n    manager: Session.IManager;\n\n    /**\n     * The initial path of the file.\n     */\n    path?: string;\n\n    /**\n     * The name of the session.\n     */\n    name?: string;\n\n    /**\n     * The type of the session.\n     */\n    type?: string;\n\n    /**\n     * A kernel preference.\n     */\n    kernelPreference?: IClientSession.IKernelPreference;\n  }\n\n  /**\n   * Restart a kernel if the user accepts the risk.\n   */\n  export\n  function restartKernel(kernel: Kernel.IKernelConnection): Promise<Kernel.IKernelConnection | null> {\n    let restartBtn = Dialog.warnButton({ label: 'RESTART '});\n    return showDialog({\n      title: 'Restart Kernel?',\n      body: 'Do you want to restart the current kernel? All variables will be lost.',\n      buttons: [Dialog.cancelButton(), restartBtn]\n    }).then(result => {\n      if (kernel.isDisposed) {\n        return Promise.resolve(null);\n      }\n      if (result.button.accept) {\n        return kernel.restart().then(() => {\n          return kernel;\n        });\n      }\n      return kernel;\n    });\n  }\n\n  /**\n   * An interface for populating a kernel selector.\n   */\n  export\n  interface IKernelSearch {\n    /**\n     * The Kernel specs.\n     */\n    specs: Kernel.ISpecModels | null;\n\n    /**\n     * The kernel preference.\n     */\n    preference: IClientSession.IKernelPreference;\n\n    /**\n     * The current running sessions.\n     */\n    sessions?: IterableOrArrayLike<Session.IModel>;\n  }\n\n  /**\n   * Get the default kernel name given select options.\n   */\n  export\n  function getDefaultKernel(options: IKernelSearch): string | null {\n    return Private.getDefaultKernel(options);\n  }\n\n  /**\n   * Populate a kernel dropdown list.\n   *\n   * @param node - The node to populate.\n   *\n   * @param options - The options used to populate the kernels.\n   *\n   * #### Notes\n   * Populates the list with separated sections:\n   *   - Kernels matching the preferred language (display names).\n   *   - \"None\" signifying no kernel.\n   *   - The remaining kernels.\n   *   - Sessions matching the preferred language (file names).\n   *   - The remaining sessions.\n   * If no preferred language is given or no kernels are found using\n   * the preferred language, the default kernel is used in the first\n   * section.  Kernels are sorted by display name.  Sessions display the\n   * base name of the file with an ellipsis overflow and a tooltip with\n   * the explicit session information.\n   */\n  export\n  function populateKernelSelect(node: HTMLSelectElement, options: IKernelSearch): void {\n    return Private.populateKernelSelect(node, options);\n  }\n}\n\n\n/**\n * The namespace for module private data.\n */\nnamespace Private {\n  /**\n   * A widget that provides a kernel selection.\n   */\n  export\n  class KernelSelector extends Widget {\n    /**\n     * Create a new kernel selector widget.\n     */\n    constructor(session: ClientSession) {\n      super({ node: createSelectorNode(session) });\n    }\n\n    /**\n     * Get the value of the kernel selector widget.\n     */\n    getValue(): Kernel.IModel {\n      let selector = this.node.querySelector('select') as HTMLSelectElement;\n      return JSON.parse(selector.value) as Kernel.IModel;\n    }\n  }\n\n  /**\n   * Create a node for a kernel selector widget.\n   */\n  function createSelectorNode(session: ClientSession) {\n    // Create the dialog body.\n    let body = document.createElement('div');\n    let text = document.createElement('label');\n    text.innerHTML = `Select kernel for: \"${session.name}\"`;\n    body.appendChild(text);\n\n    let options = getKernelSearch(session);\n    let selector = document.createElement('select');\n    ClientSession.populateKernelSelect(selector, options);\n    body.appendChild(selector);\n    return body;\n  }\n\n  /**\n   * Get the default kernel name given select options.\n   */\n  export\n  function getDefaultKernel(options: ClientSession.IKernelSearch): string | null {\n    let { specs, preference } = options;\n    let {\n      name, language, shouldStart, canStart, autoStartDefault\n    } = preference;\n\n    if (!specs || shouldStart === false || canStart === false) {\n      return null;\n    }\n\n    let defaultName = autoStartDefault ? specs.default : null;\n\n    if (!name && !language) {\n      return defaultName;\n    }\n\n    // Look for an exact match of a spec name.\n    for (let specName in specs.kernelspecs) {\n      if (specName === name) {\n        return name;\n      }\n    }\n\n    // Bail if there is no language.\n    if (!language) {\n      return defaultName;\n    }\n\n    // Check for a single kernel matching the language.\n    let matches: string[] = [];\n    for (let specName in specs.kernelspecs) {\n      let kernelLanguage = specs.kernelspecs[specName].language;\n      if (language === kernelLanguage) {\n        matches.push(specName);\n      }\n    }\n\n    if (matches.length === 1) {\n      let specName = matches[0];\n      console.log('No exact match found for ' + specName +\n                  ', using kernel ' + specName + ' that matches ' +\n                  'language=' + language);\n      return specName;\n    }\n\n    // No matches found.\n    return defaultName;\n  }\n\n  /**\n   * Populate a kernel select node for the session.\n   */\n  export\n  function populateKernelSelect(node: HTMLSelectElement, options: ClientSession.IKernelSearch): void {\n    while (node.firstChild) {\n      node.removeChild(node.firstChild);\n    }\n    let maxLength = 10;\n\n    let { preference, sessions, specs } = options;\n    let { name, id, language, canStart, shouldStart } = preference;\n\n    if (!specs || canStart === false) {\n      node.appendChild(optionForNone());\n      node.value = 'null';\n      node.disabled = true;\n      return;\n    }\n\n    node.disabled = false;\n\n    // Create mappings of display names and languages for kernel name.\n    let displayNames: { [key: string]: string } = Object.create(null);\n    let languages: { [key: string]: string } = Object.create(null);\n    for (let name in specs.kernelspecs) {\n      let spec = specs.kernelspecs[name];\n      displayNames[name] = spec.display_name;\n      maxLength = Math.max(maxLength, displayNames[name].length);\n      languages[name] = spec.language;\n    }\n\n    // Handle a kernel by name.\n    let names: string[] = [];\n    if (name && name in specs.kernelspecs) {\n      names.push(name);\n    }\n\n    // Then look by language.\n    if (language) {\n      for (let specName in specs.kernelspecs) {\n        if (name !== specName && languages[specName] === language) {\n          names.push(specName);\n        }\n      }\n    }\n\n    // Use the default kernel if no kernels were found.\n    if (!names.length) {\n      names.push(specs.default);\n    }\n\n    // Handle a preferred kernels in order of display name.\n    let preferred = document.createElement('optgroup');\n    preferred.label = 'Start Preferred Kernel';\n\n    names.sort((a, b) => displayNames[a].localeCompare(displayNames[b]));\n    for (let name of names) {\n      preferred.appendChild(optionForName(name, displayNames[name]));\n    }\n\n    if (preferred.firstChild) {\n      node.appendChild(preferred);\n    }\n\n    // Add an option for no kernel\n    node.appendChild(optionForNone());\n\n    let other = document.createElement('optgroup');\n    other.label = 'Start Other Kernel';\n\n    // Add the rest of the kernel names in alphabetical order.\n    let otherNames: string[] = [];\n    for (let specName in specs.kernelspecs) {\n      if (names.indexOf(specName) !== -1) {\n        continue;\n      }\n      otherNames.push(specName);\n    }\n    otherNames.sort((a, b) => displayNames[a].localeCompare(displayNames[b]));\n    for (let otherName of otherNames) {\n      other.appendChild(optionForName(otherName, displayNames[otherName]));\n    }\n    // Add a separator option if there were any other names.\n    if (otherNames.length) {\n      node.appendChild(other);\n    }\n\n    // Handle the default value.\n    if (shouldStart === false) {\n      node.value = 'null';\n    } else {\n      node.selectedIndex = 0;\n    }\n\n    // Bail if there are no sessions.\n    if (!sessions) {\n      return;\n    }\n\n    // Add the sessions using the preferred language first.\n    let matchingSessions: Session.IModel[] = [];\n    let otherSessions: Session.IModel[] = [];\n\n    each(sessions, session => {\n      if (language &&\n          languages[session.kernel.name] === language &&\n          session.kernel.id !== id) {\n        matchingSessions.push(session);\n      } else if (session.kernel.id !== id) {\n        otherSessions.push(session);\n      }\n    });\n\n    let matching = document.createElement('optgroup');\n    matching.label = 'Use Kernel from Preferred Session';\n    node.appendChild(matching);\n\n    if (matchingSessions.length) {\n      matchingSessions.sort((a, b) => {\n        return a.path.localeCompare(b.path);\n      });\n\n      each(matchingSessions, session => {\n        let name = displayNames[session.kernel.name];\n        matching.appendChild(optionForSession(session, name, maxLength));\n      });\n\n    }\n\n    let otherSessionsNode = document.createElement('optgroup');\n    otherSessionsNode.label = 'Use Kernel from Other Session';\n    node.appendChild(otherSessionsNode);\n\n    if (otherSessions.length) {\n      otherSessions.sort((a, b) => {\n        return a.path.localeCompare(b.path);\n      });\n\n      each(otherSessions, session => {\n        let name = displayNames[session.kernel.name] || session.kernel.name;\n        otherSessionsNode.appendChild(optionForSession(session, name, maxLength));\n      });\n    }\n  }\n\n  /**\n   * Get the kernel search options given a client session and sesion manager.\n   */\n  function getKernelSearch(session: ClientSession): ClientSession.IKernelSearch {\n    return {\n      specs: session.manager.specs,\n      sessions: session.manager.running(),\n      preference: session.kernelPreference\n    };\n  }\n\n  /**\n   * Create an option element for a kernel name.\n   */\n  function optionForName(name: string, displayName: string): HTMLOptionElement {\n    let option = document.createElement('option');\n    option.text = displayName;\n    option.value = JSON.stringify({ name });\n    return option;\n  }\n\n  /**\n   * Create an option for no kernel.\n   */\n  function optionForNone(): HTMLOptGroupElement {\n    let group = document.createElement('optgroup');\n    group.label = 'Use No Kernel';\n    let option = document.createElement('option');\n    option.text = 'No Kernel';\n    option.value = 'null';\n    group.appendChild(option);\n    return group;\n  }\n\n  /**\n   * Create an option element for a session.\n   */\n  function optionForSession(session: Session.IModel, displayName: string, maxLength: number): HTMLOptionElement {\n    let option = document.createElement('option');\n    let sessionName = session.name || PathExt.basename(session.path);\n    if (sessionName.length > maxLength) {\n      sessionName = sessionName.slice(0, maxLength - 3) + '...';\n    }\n    option.text = sessionName;\n    option.value = JSON.stringify({ id: session.kernel.id });\n    option.title = `Path: ${session.path}\\n` +\n      `Name: ${sessionName}\\n` +\n      `Kernel Name: ${displayName}\\n` +\n      `Kernel Id: ${session.kernel.id}`;\n    return option;\n  }\n}\n"]}