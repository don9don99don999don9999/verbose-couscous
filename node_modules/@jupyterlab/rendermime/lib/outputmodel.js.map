{"version":3,"file":"outputmodel.js","sourceRoot":"","sources":["../../../../rendermime/src/outputmodel.ts"],"names":[],"mappings":"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","sourcesContent":["/*-----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\nimport {\n  JSONExt, JSONObject, JSONValue, ReadonlyJSONObject\n} from '@phosphor/coreutils';\n\nimport {\n  ISignal, Signal\n} from '@phosphor/signaling';\n\nimport {\n  nbformat\n} from '@jupyterlab/coreutils';\n\nimport {\n  IObservableJSON, ObservableJSON\n} from '@jupyterlab/observables';\n\nimport {\n  IRenderMime\n} from '@jupyterlab/rendermime-interfaces';\n\nimport {\n  MimeModel\n} from './mimemodel';\n\n\n/**\n * The interface for an output model.\n */\nexport\ninterface IOutputModel extends IRenderMime.IMimeModel {\n  /**\n   * A signal emitted when the output model changes.\n   */\n  readonly changed: ISignal<this, void>;\n\n  /**\n   * The output type.\n   */\n  readonly type: string;\n\n  /**\n   * The execution count of the model.\n   */\n  readonly executionCount: nbformat.ExecutionCount;\n\n  /**\n   * Whether the output is trusted.\n   */\n  trusted: boolean;\n\n  /**\n   * Dispose of the resources used by the output model.\n   */\n  dispose(): void;\n\n  /**\n   * Serialize the model to JSON.\n   */\n  toJSON(): nbformat.IOutput;\n}\n\n\n/**\n * The namespace for IOutputModel sub-interfaces.\n */\nexport\nnamespace IOutputModel {\n  /**\n   * The options used to create a notebook output model.\n   */\n  export\n  interface IOptions {\n    /**\n     * The raw output value.\n     */\n    value: nbformat.IOutput;\n\n    /**\n     * Whether the output is trusted.  The default is false.\n     */\n    trusted?: boolean;\n  }\n}\n\n\n/**\n * The default implementation of a notebook output model.\n */\nexport\nclass OutputModel implements IOutputModel {\n  /**\n   * Construct a new output model.\n   */\n  constructor(options: IOutputModel.IOptions) {\n    let { data, metadata, trusted } = Private.getBundleOptions(options);\n    this._data = new ObservableJSON({ values: data as JSONObject });\n    this._rawData = data;\n    this._metadata = new ObservableJSON({ values: metadata as JSONObject });\n    this._rawMetadata = metadata;\n    this.trusted = trusted;\n    // Make a copy of the data.\n    let value = options.value;\n    for (let key in value) {\n      // Ignore data and metadata that were stripped.\n      switch (key) {\n      case 'data':\n      case 'metadata':\n        break;\n      default:\n        this._raw[key] = Private.extract(value, key);\n      }\n    }\n    this.type = value.output_type;\n    if (nbformat.isExecuteResult(value)) {\n      this.executionCount = value.execution_count;\n    } else {\n      this.executionCount = null;\n    }\n  }\n\n  /**\n   * A signal emitted when the output model changes.\n   */\n  get changed(): ISignal<this, void> {\n    return this._changed;\n  }\n\n  /**\n   * The output type.\n   */\n  readonly type: string;\n\n  /**\n   * The execution count.\n   */\n  readonly executionCount: nbformat.ExecutionCount;\n\n  /**\n   * Whether the model is trusted.\n   */\n  readonly trusted: boolean;\n\n  /**\n   * Dispose of the resources used by the output model.\n   */\n  dispose(): void {\n    this._data.dispose();\n    this._metadata.dispose();\n    Signal.clearData(this);\n  }\n\n  /**\n   * The data associated with the model.\n   */\n  get data(): ReadonlyJSONObject {\n    return this._rawData;\n  }\n\n  /**\n   * The metadata associated with the model.\n   */\n  get metadata(): ReadonlyJSONObject {\n    return this._rawMetadata;\n  }\n\n  /**\n   * Set the data associated with the model.\n   *\n   * #### Notes\n   * Depending on the implementation of the mime model,\n   * this call may or may not have deferred effects,\n   */\n  setData(options: IRenderMime.IMimeModel.ISetDataOptions): void {\n    if (options.data) {\n      this._updateObservable(this._data, options.data);\n      this._rawData = options.data;\n    }\n    if (options.metadata) {\n      this._updateObservable(this._metadata, options.metadata);\n      this._rawMetadata = options.metadata;\n    }\n    this._changed.emit(void 0);\n  }\n\n  /**\n   * Serialize the model to JSON.\n   */\n  toJSON(): nbformat.IOutput {\n    let output: JSONValue = {};\n    for (let key in this._raw) {\n      output[key] = Private.extract(this._raw, key);\n    }\n    switch (this.type) {\n    case 'display_data':\n    case 'execute_result':\n    case 'update_display_data':\n      output['data'] = this.data as JSONObject;\n      output['metadata'] = this.metadata as JSONObject;\n      break;\n    default:\n      break;\n    }\n    // Remove transient data.\n    delete output['transient'];\n    return output as nbformat.IOutput;\n  }\n\n  /**\n   * Update an observable JSON object using a readonly JSON object.\n   */\n  private _updateObservable(observable: IObservableJSON, data: ReadonlyJSONObject) {\n    let oldKeys = observable.keys();\n    let newKeys = Object.keys(data);\n\n    // Handle removed keys.\n    for (let key of oldKeys) {\n      if (newKeys.indexOf(key) === -1) {\n        observable.delete(key);\n      }\n    }\n\n    // Handle changed data.\n    for (let key of newKeys) {\n      let oldValue = observable.get(key);\n      let newValue = data[key];\n      if (oldValue !== newValue) {\n        observable.set(key, newValue as JSONValue);\n      }\n    }\n  }\n\n  private _changed = new Signal<this, void>(this);\n  private _raw: JSONObject = {};\n  private _rawMetadata: ReadonlyJSONObject;\n  private _rawData: ReadonlyJSONObject;\n  private _data: IObservableJSON;\n  private _metadata: IObservableJSON;\n}\n\n\n/**\n * The namespace for OutputModel statics.\n */\nexport\nnamespace OutputModel {\n  /**\n   * Get the data for an output.\n   *\n   * @params output - A kernel output message payload.\n   *\n   * @returns - The data for the payload.\n   */\n  export\n  function getData(output: nbformat.IOutput): JSONObject {\n    return Private.getData(output);\n  }\n\n  /**\n   * Get the metadata from an output message.\n   *\n   * @params output - A kernel output message payload.\n   *\n   * @returns - The metadata for the payload.\n   */\n  export\n  function getMetadata(output: nbformat.IOutput): JSONObject {\n    return Private.getMetadata(output);\n  }\n}\n\n\n/**\n * The namespace for module private data.\n */\nnamespace Private {\n  /**\n   * Get the data from a notebook output.\n   */\n  export\n  function getData(output: nbformat.IOutput): JSONObject {\n    let bundle: nbformat.IMimeBundle = {};\n    if (nbformat.isExecuteResult(output) || nbformat.isDisplayData(output) || nbformat.isDisplayUpdate(output)) {\n      bundle = (output as nbformat.IExecuteResult).data;\n    } else if (nbformat.isStream(output)) {\n      if (output.name === 'stderr') {\n        bundle['application/vnd.jupyter.stderr'] = output.text;\n      } else {\n        bundle['application/vnd.jupyter.stdout'] = output.text;\n      }\n    } else if (nbformat.isError(output)) {\n      let traceback = output.traceback.join('\\n');\n      bundle['application/vnd.jupyter.stderr'] = (\n        traceback || `${output.ename}: ${output.evalue}`\n      );\n    }\n    return convertBundle(bundle);\n  }\n\n  /**\n   * Get the metadata from an output message.\n   */\n  export\n  function getMetadata(output: nbformat.IOutput): JSONObject {\n    let value: JSONObject = Object.create(null);\n    if (nbformat.isExecuteResult(output) || nbformat.isDisplayData(output)) {\n      for (let key in output.metadata) {\n        value[key] = extract(output.metadata, key);\n      }\n    }\n    return value;\n  }\n\n  /**\n   * Get the bundle options given output model options.\n   */\n  export\n  function getBundleOptions(options: IOutputModel.IOptions): MimeModel.IOptions {\n    let data = getData(options.value);\n    let metadata = getMetadata(options.value);\n    let trusted = !!options.trusted;\n    return { data, metadata, trusted };\n  }\n\n  /**\n   * Extract a value from a JSONObject.\n   */\n  export\n  function extract(value: JSONObject, key: string): JSONValue {\n    let item = value[key];\n    if (JSONExt.isPrimitive(item)) {\n      return item;\n    }\n    return JSON.parse(JSON.stringify(item));\n  }\n\n  /**\n   * Convert a mime bundle to mime data.\n   */\n  function convertBundle(bundle: nbformat.IMimeBundle): JSONObject {\n    let map: JSONObject = Object.create(null);\n    for (let mimeType in bundle) {\n      let item = bundle[mimeType];\n      // Convert multi-line strings to strings.\n      if (JSONExt.isArray(item)) {\n        item = (item as string[]).join('\\n');\n      } else if (!JSONExt.isPrimitive(item)) {\n        item = JSON.parse(JSON.stringify(item));\n      }\n      map[mimeType] = item;\n    }\n    return map;\n  }\n}\n"]}